<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running Simulations &mdash; Illuminator 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=857d7e63" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=8d563738"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Connections" href="connections.html" />
    <link rel="prev" title="Simulation Configuration File" href="config-file.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/illuminator.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Educational tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials-overview.html">Tutorials Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial1.html">Tutorial: Power Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial2.html">Tutorial: Electricity Markets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial3.html">Tutorial: Grid Congestion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="config-file.html">Simulation Configuration File</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#python-script">Python Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#command-line">Command Line</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#running-simulations-in-parallel">Running Simulations in Parallel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-predefined-simulations">1. Using Predefined Simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-a-multi-parameter-scenario-file">2. Using a Multi-Parameter Scenario File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#yaml-schema-for-multi-parameters">YAML Schema for Multi-Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lookup-table-and-output-files">Lookup Table and Output Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-locally">Run locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-in-delftblue">Run in DelftBlue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initial-setup">Initial setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submit-a-job">Submit a job</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/models.html">Illuminator Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/set-up.html">Set Up Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/software-architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/repo-automation.html">Website automation and github actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/developer-docstrings.html">Custom Model Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/testing-explained.html">Testing: basic principles and ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/writing-tests.html">Creating/writing tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/dev-website-contribute.html">Website contributing guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future Work</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/dev-cluster-setup.html">Illuminator Cluster Set Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/dev-dashboard.html">Dashboard</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/scenario-api.html">Scenario API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Illuminator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Running Simulations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/simulations.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-simulations">
<h1>Running Simulations<a class="headerlink" href="#running-simulations" title="Link to this heading"></a></h1>
<p>Simulations can be directly run in a python script or using the <em>command line interface</em> (CLI).</p>
<section id="python-script">
<h2>Python Script<a class="headerlink" href="#python-script" title="Link to this heading"></a></h2>
<p>To run a simulation from Python, you need to provide a <a class="reference internal" href="config-file.html"><span class="std std-doc">configuration file</span></a>. Then you can start the simulation as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">illuminator.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Simulation</span>

<span class="n">simulation</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="s1">&#39;&lt;path/to/scenario_config.yaml&gt;&#39;</span><span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

</pre></div>
</div>
</section>
<section id="command-line">
<h2>Command Line<a class="headerlink" href="#command-line" title="Link to this heading"></a></h2>
<p>You can use the command <code class="docutils literal notranslate"><span class="pre">scenario</span> <span class="pre">run</span></code> to start a simulation from the terminal:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>illuminator<span class="w"> </span>scenario<span class="w"> </span>run<span class="w"> </span>&lt;path/to/scenario_config.yaml&gt;
</pre></div>
</div>
<p><em>Feature added in October 2025 as part of the support from the Digital Competence Centre.</em></p>
</section>
</section>
<section id="running-simulations-in-parallel">
<h1>Running Simulations in Parallel<a class="headerlink" href="#running-simulations-in-parallel" title="Link to this heading"></a></h1>
<p>The Illuminator allows users to run multiple scenarios in parallel by distributing simulations across processors, reducing the overall runtime when executing many independent simulations.</p>
<p>The parallel execution feature distributes simulation workloads across multiple CPU cores or HPC compute nodes using the Message Passing Interface (MPI) via the mpi4py Python library. Each simulation is executed independently, making the feature ideal for exploring large parameter spaces as part of a sensitivity analysis workflow or batch scenario evaluations.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The feature introduces two complementary functions in the <code class="docutils literal notranslate"><span class="pre">illuminator.parallel_scenarios</span></code> module:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">run_parallel(simlist,</span> <span class="pre">create_scenario_files=False)</span></code></p></td>
<td><p>Runs a list of pre-configured <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> objects in parallel. Optionally writes a scenario YAML file for each simulation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">run_parallel_file(scenario_file)</span></code></p></td>
<td><p>Expands a multi-parameter scenario YAML file into individual simulations and runs them in parallel. Generates scenario YAML files and a lookup table summarizing parameter combinations. Can be accessed from the CLI app via <code class="docutils literal notranslate"><span class="pre">illuminator</span> <span class="pre">scenario</span> <span class="pre">run_parallel</span> <span class="pre">&lt;myscenario.yaml&gt;</span></code></p></td>
</tr>
</tbody>
</table>
<p>Both functions internally manage MPI rank assignment and ensure that each process runs a unique subset of the total simulations. If there are more simulations than MPI processes, simulations are distributed evenly across ranks. If fewer simulations exist, extra ranks remain idle.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="using-predefined-simulations">
<h3>1. Using Predefined Simulations<a class="headerlink" href="#using-predefined-simulations" title="Link to this heading"></a></h3>
<p>If you already have a list of <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#run_my_sims.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">illuminator.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Simulation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">illuminator.parallel_scenarions</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_parallel</span>

<span class="c1"># Define a list of simulation objects</span>
<span class="n">simlist</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Simulation</span><span class="p">(</span><span class="s2">&quot;scenario1.yaml&quot;</span><span class="p">),</span>
    <span class="n">Simulation</span><span class="p">(</span><span class="s2">&quot;scenario2.yaml&quot;</span><span class="p">),</span>
    <span class="n">Simulation</span><span class="p">(</span><span class="s2">&quot;scenario3.yaml&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Run all simulations in parallel (using MPI)</span>
<span class="n">run_parallel</span><span class="p">(</span><span class="n">simlist</span><span class="p">,</span> <span class="n">create_scenario_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To launch in parallel with 4 processors, use <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> or your cluster’s job scheduler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span>python<span class="w"> </span>run_my_sims.py
</pre></div>
</div>
</section>
<section id="using-a-multi-parameter-scenario-file">
<h3>2. Using a Multi-Parameter Scenario File<a class="headerlink" href="#using-a-multi-parameter-scenario-file" title="Link to this heading"></a></h3>
<p>The Illuminator also supports concurrently running multiple model parameter combinations from a single YAML scenario file. This approach has the upside of performing many simulations without manually creating separate scenario files.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">run_parallel_file(scenario_file)</span></code>:</p>
<ul class="simple">
<li><p>Expands all parameter/state combinations automatically</p></li>
<li><p>Writes derived scenario YAMLs to disk (e.g., myscenario_1.yaml, myscenario_2.yaml, …)</p></li>
<li><p>Executes simulations in parallel; each processor (MPI rank) runs a unique subset of simulations</p></li>
<li><p>Generates a lookup table (scenariotable.csv) summarizing the parameter combinations</p></li>
</ul>
<p>To run the simulations defined in a multi-parameter scenario file with 8 processors use <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> or your cluster’s job scheduler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">8</span><span class="w"> </span>illuminator<span class="w"> </span>scenario<span class="w"> </span>run_parallel<span class="w"> </span>myscenario.yaml
</pre></div>
</div>
<section id="yaml-schema-for-multi-parameters">
<h4>YAML Schema for Multi-Parameters<a class="headerlink" href="#yaml-schema-for-multi-parameters" title="Link to this heading"></a></h4>
<p>To define multiple parameter values in a single scenario, use a <code class="docutils literal notranslate"><span class="pre">multi_parameters</span></code> section under each model. Each entry in multi_parameters specifies either a <code class="docutils literal notranslate"><span class="pre">list</span></code> or a <code class="docutils literal notranslate"><span class="pre">range</span></code> of values to iterate over. If you use a range, it must define integer values for the minimum, maximum, and step. Lists can include floating-point numbers. You can vary as many parameters across as many models as you like.</p>
<p>An optional <code class="docutils literal notranslate"><span class="pre">align_parameters</span></code> key under the scenario section specifies how the mulit_parameters should be combined. When set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the corresponding parameter lists or ranges are combined by index (aligned). This option requires all lists or ranges to be of equal length. When set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, all possible parameter combinations are generated (Cartesian product). If align_parameters is not defined, it is set to False by default.</p>
<p>For example, depending on the <code class="docutils literal notranslate"><span class="pre">align_parameters</span></code> setting, the following example would produce:</p>
<ul class="simple">
<li><p>True → Generates 2 scenarios: (1000, 80) and (1500, 90)</p></li>
<li><p>False → Generates 4 scenarios: (1000, 80), (1000, 90), (1500, 80) and (1500, 90)</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Neighborhood_scenario1&quot;</span>
<span class="w">  </span><span class="nt">start_time</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2007-07-02</span><span class="nv"> </span><span class="s">00:00:00&#39;</span>
<span class="w">  </span><span class="nt">end_time</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2007-07-02</span><span class="nv"> </span><span class="s">23:45:00&#39;</span>
<span class="w">  </span><span class="nt">time_resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>
<span class="w">  </span><span class="nt">align_parameters</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="nt">models</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Battery1</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Battery</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max_p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">      </span><span class="nt">min_p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-500</span>
<span class="w">      </span><span class="nt">discharge_efficiency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">      </span><span class="nt">soc_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">soc_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">    </span><span class="nt">multi_parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max_energy</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1500</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># List</span>
<span class="w">      </span><span class="nt">charge_efficiency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">range(80, 90, 10)</span><span class="w"> </span><span class="c1"># range (min=80, max=90, step=5)</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">states</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</section>
<section id="lookup-table-and-output-files">
<h4>Lookup Table and Output Files<a class="headerlink" href="#lookup-table-and-output-files" title="Link to this heading"></a></h4>
<p>When <code class="docutils literal notranslate"><span class="pre">run_parallel_file()</span></code> executes:</p>
<ul class="simple">
<li><p>A file named <code class="docutils literal notranslate"><span class="pre">scenariotable.csv</span></code> is automatically generated in the output directory. This file maps each simulation ID to its corresponding parameter values, allowing easy reference between results and scenario configuration.</p></li>
<li><p>In the YAML scenario file, <strong>only one output file should be defined</strong> under the <code class="docutils literal notranslate"><span class="pre">monitor</span></code> section. The Illuminator will automatically append the simulation ID number to the output filename, ensuring results from different simulations do not overwrite each other.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">monitor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">output_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;results/simulation_output.csv&quot;</span>
</pre></div>
</div>
<p>will produce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">/</span><span class="n">simulation_output_1</span><span class="o">.</span><span class="n">csv</span>
<span class="n">results</span><span class="o">/</span><span class="n">simulation_output_2</span><span class="o">.</span><span class="n">csv</span>
<span class="n">results</span><span class="o">/</span><span class="n">simulation_output_3</span><span class="o">.</span><span class="n">csv</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="run-locally">
<h2>Run locally<a class="headerlink" href="#run-locally" title="Link to this heading"></a></h2>
<p>You can run Illuminator simulations in parallel in your machine if <strong>OpenMPI</strong> (or another MPI implementation) is installed and accessible to Python via <code class="docutils literal notranslate"><span class="pre">mpi4py</span></code>.</p>
<details>
<summary> Installation of OpenMPI</summary>
<p><strong>Linux</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openmpi-bin<span class="w"> </span>libopenmpi-dev
</pre></div>
</div>
<p><strong>MacOS</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>open-mpi
</pre></div>
</div>
<p><strong>Windows</strong></p>
<ol class="arabic simple">
<li><p>Install Microsoft MPI (MS-MPI) from the <a class="reference external" href="https://learn.microsoft.com/en-us/message-passing-interface/microsoft-mpi">Microsoft’s website</a></p></li>
<li><p>Add the MPI <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory (e.g., <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Microsoft</span> <span class="pre">MPI\Bin</span></code>) to your system <code class="docutils literal notranslate"><span class="pre">PATH</span></code></p></li>
</ol>
</details>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clone the repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Illuminator-team/Illuminator.git
<span class="nb">cd</span><span class="w"> </span>Illuminator

<span class="c1"># Checkout the dev-mpi-prallel branch (feature currently only available there)</span>
git<span class="w"> </span>checkout<span class="w"> </span>dev-mpi-parallel

<span class="c1"># Install the dependencies in a Conda environment</span>
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml
conda<span class="w"> </span>activate<span class="w"> </span>illuminator

<span class="c1"># Uninstall the illuminator that comes from environment.yml (from PyPi)</span>
pip<span class="w"> </span>uninstall<span class="w"> </span>illuminator

<span class="c1"># Build and install illuminator from the dev-mpi-parallel branch</span>
pip<span class="w"> </span>install<span class="w"> </span>.

<span class="c1"># Run all simulations defined in a multi-parameter scenario file</span>
mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span>illuminator<span class="w"> </span>scenario<span class="w"> </span>run_parallel<span class="w"> </span>myscenario.yaml
</pre></div>
</div>
</section>
<section id="run-in-delftblue">
<h2>Run in DelftBlue<a class="headerlink" href="#run-in-delftblue" title="Link to this heading"></a></h2>
<p>Although the following example is tailored for the DelftBlue cluster, the setup can be easily adapted for any other HPC clusters. The example demonstrates how to submit a SLURM job that executes the Illuminator’s run_parallel command.</p>
<section id="initial-setup">
<h3>Initial setup<a class="headerlink" href="#initial-setup" title="Link to this heading"></a></h3>
<p>The initial setup of configuring conda and creating the illuminator environment need to be done only once.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to the cluster</span>
ssh<span class="w"> </span>netid@login.delftblue.tudelft.nl

<span class="c1"># Load miniconda module</span>
module<span class="w"> </span>load<span class="w"> </span>miniconda3

<span class="c1"># Optional: make conda install packages in /scratch instead of /home</span>
<span class="c1"># https://doc.dhpc.tudelft.nl/delftblue/howtos/conda/</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/scratch/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/.conda
ln<span class="w"> </span>-s<span class="w"> </span>/scratch/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/.conda<span class="w"> </span><span class="nv">$HOME</span>/.conda

<span class="c1"># Clone the Illuminator repository</span>
<span class="nb">cd</span><span class="w"> </span>scratch/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="w"> </span><span class="c1"># optional: work in the /scratch partition as /home only has 30GB of storage per user</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Illuminator-team/Illuminator.git
<span class="nb">cd</span><span class="w"> </span>Illuminator

<span class="c1"># Checkout the dev-mpi-prallel branch (parallel feature currently only available there)</span>
git<span class="w"> </span>checkout<span class="w"> </span>dev-mpi-parallel

<span class="c1"># Install the dependencies in a Conda environment</span>
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml
conda<span class="w"> </span>activate<span class="w"> </span>illuminator

<span class="c1"># Uninstall the illuminator that comes from environment.yml (from PyPi)</span>
pip<span class="w"> </span>uninstall<span class="w"> </span>illuminator

<span class="c1"># Build and install illuminator from the dev-mpi-parallel branch</span>
pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="submit-a-job">
<h3>Submit a job<a class="headerlink" href="#submit-a-job" title="Link to this heading"></a></h3>
<p>Create a multi-parameter scenario file, e.g. <code class="docutils literal notranslate"><span class="pre">myscenario.yml</span></code>. In the same directory, create a job submission script, e.g. <code class="docutils literal notranslate"><span class="pre">run_illuminator.sh</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#SBATCH --job-name=&quot;illum&quot;
#SBATCH --time=00:30:00        # max job runtime in hh:mm:ss
#SBATCH --ntasks=1             # num of processes (MPI ranks)
#SBATCH --cpus-per-task=1      # num threads per MPI process (irrelevant for now)
#SBATCH --mem-per-cpu=1G
#SBATCH --partition=compute
 
# Load required modules:
module load miniconda3
module load 2025
module load openmpi
 
# Reset any pre-existing conda nesting
# https://doc.dhpc.tudelft.nl/delftblue/Python/#conda
unset CONDA_SHLVL
source &quot;$(conda info --base)/etc/profile.d/conda.sh&quot;
 
# Activate illuminator conda environment
#conda env create -f ../../environment.yml
conda activate illuminator
 
# Run simulations in multi-parameter scenario file, in parallel using MPI
srun illuminator scenario run_parallel myscenario.yml
 
# Deactivate environment
conda deactivate
 
# Optional: print job efficiency summary
seff $SLURM_JOB_ID
</pre></div>
</div>
<p>Submit the job with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sbatch</span> <span class="n">run_illuminator</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Link to this heading"></a></h2>
<p>Tests to ensure the feature behaves as expected were added to <code class="docutils literal notranslate"><span class="pre">tests/parallel_scenarios</span></code>. A local <strong>OpenMPI</strong> (or another MPI implementation) installation is needed to run the tests. All the data needed to run the tests is located in tests/parallel_scenarios/data.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clone the repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Illuminator-team/Illuminator.git
<span class="nb">cd</span><span class="w"> </span>Illuminator

<span class="c1"># Checkout the dev-mpi-prallel branch (feature currently only available there)</span>
git<span class="w"> </span>checkout<span class="w"> </span>dev-mpi-parallel

<span class="c1"># Install the dependencies in a Conda environment</span>
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml
conda<span class="w"> </span>activate<span class="w"> </span>illuminator

<span class="c1"># Uninstall the illuminator that comes from environment.yml (from PyPi)</span>
pip<span class="w"> </span>uninstall<span class="w"> </span>illuminator

<span class="c1"># Build and install illuminator from the dev-mpi-parallel branch</span>
pip<span class="w"> </span>install<span class="w"> </span>.

<span class="c1"># Run the tests</span>
pytest<span class="w"> </span>tests/parallel_scenarios
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config-file.html" class="btn btn-neutral float-left" title="Simulation Configuration File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="connections.html" class="btn btn-neutral float-right" title="Connections" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Illuminator Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>